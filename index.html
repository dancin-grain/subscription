<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title>Document</title>
    
    <style>
            body{
        background-color: #fdf9ee;
        font-family: 'Google Sans', Roboto, Helvetica, Arial, sans-serif;
      }
     #introEntire, .whiteRoundedBox {
    /* font-family: Roboto,RobotoDraft,Helvetica,Arial,sans-serif; */
    /* word-wrap: break-word; */
    /* transition: box-shadow 280ms cubic-bezier(0.4,0,0.2,1); */
    border: 1px solid #dadce0;
    border-radius: 8px;
    /* display: flex; */
    
    background-color: white;
    /* background-color: #fff; */
    /* position: relative; */
    /* box-shadow: none; */
    }

    body{
        width:800px;
        margin:0 auto;
    }

   

    #darkOrange{
        
    /* word-wrap: break-word; */
    /* border-top-left-radius: 8px; */
    /* border-top-right-radius: 8px; */
    height: 10px;
    /* left: -1px; */
    /* position: absolute; */
    /* top: -1px; */
    /* width: calc(100% + 2px); */
    background-color: rgb(246, 227, 171);
    color: rgba(0, 0, 0, 1);
    }

    #intro{
        
        padding-left: 25px;
        height:144px;
    }

    .twentyPcent{
      font-size: 25px;
    }
    select{

        padding: 2px 3px;
        /* border: 2px solid rgb(118, 118, 118); */
        width: 162.4px;
        box-sizing: content-box;

    }

    .plus, .minus{
      vertical-align: bottom;
      box-sizing: border-box;
      display: inline-block;
      margin-left: 12px;
     
      width: 21.47px;
      height: 21.47px;
      border-radius: 1px;
      line-height: 17.4px;
      background-color: transparent;
      color: rgb(180, 180, 180);
      text-align: center;
      border: 1px solid rgb(180 180 180);
      cursor: pointer;
      margin-bottom: 0px;
      user-select: none;
    }

    .minus{
      font-weight:bolder;
    }

    /* label{
      display: inline-block;
      margin-bottom: 5px;
    } */

    section{
      margin-bottom: 5px;
    }
    button{
        background-color: white;
        border: 1px solid #dadce0;
        border-radius: 5px;
        color: rgb(156, 117, 0);
        padding: 10px 20px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
       
        margin-right: 12px;
        cursor: pointer;
    }

    /* #addASet{
      color: rgb(156, 117, 0);
      background-color: #fef9ee;
    } */
    
    .smaller {
      color: #606060;
      font-size: 13.5px;
    }
    input[type="Number"]{
      width:132px;
    }
    input[name="Address"]{
      width:324.8px;
    }

    ul{
      padding-left: 16px;
      margin-bottom: 25px;
    }

    li{
      padding-bottom: 7px;
    }
    input[type="submit"]{
        background-color: rgb(156, 117, 0);
    border: 1px solid #dadce0;
    border-radius: 5px;
    color: white;
    padding: 10px 20px;
    text-align: center;
    text-decoration: none;
    display: inline-block;
    margin-right: 12px;
    cursor: pointer;
    }

    .whiteRoundedBox{
        margin-top: 12px;
        padding-top: 10px;
        padding-left: 25px;
        padding-right: 25px;
        padding-bottom: 25px;
    }
    .whiteRoundedBox.drinksStyle {
    width: 260px;
    display: inline-block;
    box-sizing: border-box;
    margin-right: calc((800px - 780px)/2);
}
.whiteRoundedBox.drinksStyle.bs {
    
    margin-right: 0px;
  }
     ::-webkit-scrollbar{
                width:10px;
            }
            ::-webkit-scrollbar-track{
                border-radius: 5px;
            }

            ::-webkit-scrollbar-thumb{
                border-radius: 5px;
                background-color: rgb(246, 227, 171);
            }


  @media screen and (max-width: 810px){
        body{
          width:100%;
          
      }

      #intro {
          
          height: auto;
      }

      textarea {
        width: calc(100% - 30px);
      }

      img{
        width: 100%;
        display: block;
      }
      .whiteRoundedBox.drinksStyle.pf {
    
    margin-right: calc(100% - 530px);
  }
  .whiteRoundedBox.drinksStyle.bs {
    
    margin-right: calc(100% - 530px);
  }
  .whiteRoundedBox.drinksStyle.fb {
  
  margin-right: calc(100% - 530px);
}
  .whiteRoundedBox.drinksStyle.rl {
  
    margin-right: 10px !important; /* important used to overwrite inline css*/
  }
    }

    @media screen and (max-width: 539px){
      input[type="Number"]{
      width:auto;
    }
      .whiteRoundedBox.drinksStyle {
    width: auto;
    display: block;
    margin-right: 0px !important; /* overwrite the important above*/
}
    .whiteRoundedBox.drinksStyle.rl {
        margin-right: 0px !important; /* overwrite the important above*/
    }
    .productPhoto{
      width:239px !important;
    }
      
    }
    </style>

</head>
<body>
    <p id="asd"></p>
        <form name="google-sheet" method="POST" >
            <div id="introEntire">
              <div id="darkOrange"></div>
              <div id="intro">
                <h1>Dancin Grain Subscription</h1>
                <p>Enjoy discounts of up to <b class="twentyPcent">20%</b> off and free delivery!</p>
                <p style="
    
    font-size: 16px;
">Disclaimer: Minimum of 6 bottles weekly</p>
              </div>
            </div>
            <div id="section1">

              <div class="whiteRoundedBox" id="preset"> 
                <!-- id and function name canot be the same, otherwise u cant call addSet -->
                <p>Subscription Plan&nbsp;&nbsp;&nbsp;</p>
                <p class="smaller" style="margin-bottom:23px;">**The selected drinks below will be delivered weekly <b>every Thursday (7pm - 10pm) </b> till the end of the subscription period. The first delivery will begin in the following week.**</p>  
              
                <div id="set1">
                  
                  <select id="mplan" onchange="calculatePricePart1(berryNiceNo, 'set1')">
                    <option value="0.9">2 months (10% off)</option>
                    <option value="0.8">3 months (20% off)</option>
                  </select>
                  <br>
              </div>
            </div>
              <div class="whiteRoundedBox">  
                <p>Name</p>
                <!-- added the class noOfBottle to check whether user input positive number of phone number -->
                <input type="text" class="section1InputText" name="Name"> 
              </div>
              <div class="whiteRoundedBox">  
                  <p>Phone Number (sg)</p>
                  <!-- added the class noOfBottle to check whether user input positive number of phone number -->
                  <input type="text" class="section1InputText" name="Phone Number (sg)"> 
              </div>
              <div class="whiteRoundedBox">  
                  <p>Email Address</p>
                  <input type="email" id="email" class="section1InputText" name="Email Address">
              </div>

              
      
              <div class="whiteRoundedBox drinksStyle"> 
                  <p>No. of Berry Nice</p>
                  <!--<img class="productPhoto" style="width:208px;" src="https://drive.google.com/uc?export=download&id=1sJ37F4DgL5WWWoJ8IfLaDhYNMmy6-mDZ"> -->
		  <img class="productPhoto" style="width:208px;" src="https://i.imgur.com/O7QXSLN.jpeg">
                  <input type="number" id="berryNice" class="noOfBottle" oninput="calculatePricePart1(this.value, 1)" name="No. of Berry Nice" min="0" value="0"><p class="minus" onclick="minus($('#berryNice'), 1)">-</p><p class="plus" onclick="plus($('#berryNice'), 1)">+</p> 
              </div><!--
          
              --><div class="whiteRoundedBox drinksStyle pf"> 
                  <p>No. of Passion Fruit</p>
                  <img class="productPhoto" style="width:208px;" src="https://i.imgur.com/ZKBSjb9.jpeg">
                  <input type="number" id="passionFruit" class="noOfBottle" oninput="calculatePricePart1(this.value, 2)" name="No. of Passion Fruit" min="0" value="0"><p class="minus" onclick="minus($('#passionFruit'), 2)">-</p><p class="plus" onclick="plus($('#passionFruit'), 2)">+</p> 
              </div><!--
          
              --><div class="whiteRoundedBox drinksStyle rl" style="margin-right:0px;"> 
                  <p>No. of Rose Lychee</p>
                  <img class="productPhoto" style="width:208px;" src="https://i.imgur.com/3WfzDYw.jpeg">
                  <input type="number" id="roseLychee" class="noOfBottle" oninput="calculatePricePart1(this.value, 3)" name="No. of Rose Lychee" min="0" value="0"><p class="minus" onclick="minus($('#roseLychee'), 3)">-</p><p class="plus" onclick="plus($('#roseLychee'), 3)">+</p> 
              </div><!--
          
              --><div class="whiteRoundedBox drinksStyle fb"> 
                  <p>No. of Floral Blend</p>
                  <img class="productPhoto" style="width:208px;" src="https://i.imgur.com/nShM7It.jpeg">
                  <input type="number" id="floralBlend" class="noOfBottle" oninput="calculatePricePart1(this.value, 4)" name="No. of Floral Blend" min="0" value="0"><p class="minus" onclick="minus($('#floralBlend'), 4)">-</p><p class="plus" onclick="plus($('#floralBlend'), 4)">+</p> 
              </div><!--
          
              --><div class="whiteRoundedBox drinksStyle"> 
                <p>No. of Chrysanthemum</p>
                <img class="productPhoto" style="width:208px;" src="https://i.imgur.com/CZgOWMB.jpeg">
                <input type="number" id="chrysanthemum" class="noOfBottle" oninput="calculatePricePart1(this.value, 5)" name="No. of Chrysanthemum" min="0" value="0"><p class="minus" onclick="minus($('#chrysanthemum'), 5)">-</p><p class="plus" onclick="plus($('#chrysanthemum'), 5)">+</p> 
              </div><!--
            
              --><div class="whiteRoundedBox drinksStyle bs"> 
                <p>No. of Berry Spooky <i style=" color: #d00000; ">*NEW*</i></p>
                <img class="productPhoto" style="width:208px;" src="https://i.imgur.com/NUohaIB.jpeg">
                <input type="number" id="berrySpooky" class="noOfBottle" oninput="calculatePricePart1(this.value, 6)" name="No. of Berry Spooky" min="0" value="0"><p class="minus" onclick="minus($('#berrySpooky'), 6)">-</p><p class="plus" onclick="plus($('#berrySpooky'), 6)">+</p> 
            </div>
            <input type="hidden" name="Presets">
            <input type="hidden"  name="Total Bottles">
            <input type="hidden"  name="Total Price">
            <div class="whiteRoundedBox" id="preset" style="display:none"> 
              <!-- id and function name canot be the same, otherwise u cant call addSet -->
              <p style="display: inline-block;"><b>Pre-sets&nbsp;&nbsp;&nbsp;</b></p> <button id="addASet" type="button" onclick="addSet()">Add Set</button> 
              <br/> <br/>
              <div id="set1">
                <p>Set A</p>
                <select name="set1Part1" onchange="calculatePricePart3($('#set1No').val(), 'set1')">
                  <option value="bn">Berry Nice</option>
                  <option value="pf">Passion Fruit</option>
                  <option value="rl">Rose Lychee</option>
                  <option value="fb">Floral Blend</option>
                  <option value="c">Chrysanthemum</option>
                  <option value="bs">Berry Spooky</option>
                </select>
                <br/>
                <select name="set1Part2" onchange="calculatePricePart3($('#set1No').val(), 'set1')">
                  <option value="bn">Berry Nice</option>
                  <option value="pf" selected="selected">Passion Fruit</option>
                  <option value="rl">Rose Lychee</option>
                  <option value="fb">Floral Blend</option>
                  <option value="c">Chrysanthemum</option>
                  <option value="bs">Berry Spooky</option>
                </select>
                <br/>
                <select name="set1Part3" onchange="calculatePricePart3($('#set1No').val(), 'set1')">
                  <option value="bn">Berry Nice</option>
                  <option value="pf">Passion Fruit</option>
                  <option value="rl" selected="selected">Rose Lychee</option>
                  <option value="fb">Floral Blend</option>
                  <option value="c">Chrysanthemum</option>
                  <option value="bs">Berry Spooky</option>
                </select>
                <br/>
                <select name="set1Part4" onchange="calculatePricePart3($('#set1No').val(), 'set1')">
                  <option value="bn">Berry Nice</option>
                  <option value="pf">Passion Fruit</option>
                  <option value="rl">Rose Lychee</option>
                  <option value="fb" selected="selected">Floral Blend</option>
                  <option value="c">Chrysanthemum</option>
                  <option value="bs">Berry Spooky</option>
                </select>
                <br/>
                <p>No. of Set A</p>
                <input type="number" id="set1No" class="noOfBottle" oninput="calculatePricePart3(this.value, 'set1')" name="No. of Set1" min="0" value="0"><p class="minus" onclick="minusSet($('#set1No'), 'set1')">-</p><p class="plus" onclick="plusSet($('#set1No'), 'set1')">+</p>
                <br/>
                <br/>
                <button id="deleteSet1" type="button" onclick="deleteSet('set1')">Delete Set</button>
                <br/>
                <br/>
                <br/>
            </div>
          </div>
      
              
             
          

            
              <p class="totalPrice"></p>
      
              <button id="sect1Next" type="button">Next</button>
              <p></p>
            </div>
            
      
            <div id="section3" style="display: none;">

                <div class="whiteRoundedBox"> 
                    <p>Postal Code</p>
                    <input type="text" class="section3InputText" name="Postal Code" oninput="getAddress(this)">
                    
                </div>

              <div class="whiteRoundedBox"> 
                  <p>Address</p>
                  
                  <input type="text" class="section3InputText" name="Address">
              </div>
      
              <div class="whiteRoundedBox"> 
                  <p>Unit Number</p>
                  <input type="text" class="section3InputText" name="Unit Number">
              </div>
                  
                  <p><b id="deliveryDate"></b></p>
                  <p></p>
                  <button id="sect3Back" type="button">Back</button>
                  <button id="sect3Next" type="button">Next</button>
            </div>
            <div id="section4" style="display: none;">
              <!-- <input type="hidden" name="entry.1020438313"> -->
            
              <div class="whiteRoundedBox"> 
                <p id="orderSummary"></p>
                <p class="totalPrice" style="margin-bottom: 0px;"></p>
              </div>

              
              <div class="whiteRoundedBox"> 
                <p>(PayLah!/PayNow) Transaction Ref. No./Google Transaction ID</p>
                <p>𝟏.𝐒𝐜𝐚𝐧 𝐭𝐡𝐞 𝐟𝐨𝐥𝐥𝐨𝐰𝐢𝐧𝐠 𝐐𝐑 𝐜𝐨𝐝𝐞 𝐮𝐬𝐢𝐧𝐠 𝐏𝐚𝐲𝐋𝐚𝐡!/𝐏𝐚𝐲𝐍𝐨𝐰 𝐭𝐨 𝐬𝐞𝐧𝐝 𝐭𝐡𝐞 𝐩𝐚𝐲𝐦𝐞𝐧𝐭 𝐭𝐨 𝟗𝟔𝟏𝟕𝟏𝟏𝟏𝟗 (𝐍𝐨𝐞𝐥𝐞𝐧𝐠).</p>
                <div id="dynamicImageCutOff"style="
  overflow: hidden;
  margin: 0px auto;
">
<img id="qrcode" style="
  /* max-height: 300px; */
  /* max-width: 50px; */
  /* overflow: hidden; */
  display: block;
  margin: 0px auto;
">
</div>
<p id="qrcodeText" style="
  margin: -1px;
  text-align: center;
  color: #771c79;
"></p>
<p style="
margin-top: 23px;
">𝟐.𝐔𝐩𝐥𝐨𝐚𝐝 𝐚 𝐬𝐜𝐫𝐞𝐞𝐧𝐬𝐡𝐨𝐭 𝐨𝐟 𝐭𝐡𝐞 "𝐓𝐫𝐚𝐧𝐬𝐚𝐜𝐭𝐢𝐨𝐧 𝐑𝐞𝐟. 𝐍𝐨./𝐆𝐨𝐨𝐠𝐥𝐞 𝐓𝐫𝐚𝐧𝐬𝐚𝐜𝐭𝐢𝐨𝐧 𝐈𝐃" 𝐡𝐞𝐫𝐞.</p>  
                <img  src="https://i.imgur.com/seox2js.png">
                <p></p>
                <input type="file" name="(PayLah!/PayNow) Transaction Ref. No./Google Transaction ID" id="myFile">
            </div>
              
              
              <b><p id="processing"></p></b>
              <button id="sect4Back" type="button">Back</button>
               
            <input type="submit" id="submitBtn" value="Submit">
           
            <p></p>
            </div>
           
            <!-- <input type="button" id="submitBtn" onclick="submission(this)" value="Upload Files"/> -->
            
            
          </form>









          <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
      
    //   document.getElementById('submitBtn').addEventListener('click', 
    //   function(e){
    //       $('#submitBtn').prop('disabled', true);
    //      google.script.run.withSuccessHandler(onSuccess).uploadFiles(this.parentNode.parentNode); // this.parentNode wont work as uploadFiles is expecting a form element as an object to access the myFile property/element
    //   });
      // function submission(e){
      //   google.script.run.uploadFiles(e.parentNode);
      // }

    //   function onSuccess(data){
    //     if(document.getElementById("myFile").value == ""){
    //       alert("Please upload a screen shot of the 'Transaction Ref. No./Google Transcation ID'");
    //       $('#submitBtn').prop('disabled', false);
    //       return;
    //     }
    //     document.getElementsByName('entry.1020438313')[0].value =  data;
    //     $("input[type='submit']").trigger("click");
    //   }















    // var options = {year: '2-digit', month: 'short', day: 'numeric' };
    // var options2 = { weekday: 'short', year: 'numeric', month: 'long', day: 'numeric' };
    // var today  = new Date();
    // var slackTimeDaysDelivery = {"Mon": 8, "Tue": 7, "Wed": 6, "Thu": 5, "Fri": 4, "Sat": 10, "Sun": 9};
   

    // $("#deliveryDate").text("**All selected drinks will be delivered every Tuesday till the end of the billing period from" + new Date(Date.now() + 1000*60*60*24*slackTimeDaysDelivery[today.toLocaleDateString("en-US", options2).substring(0,3)]).toLocaleDateString("en-US", options) + ", (7pm to 10pm)**");








      document.getElementById("myFile").addEventListener('change', function(){
         var ext = this.value.match(/\.[^\.]+$/)[0]; // \. is for escaping and interpreting as .

         switch(ext){
           case ".png":
           case ".jpg":
           case ".jpeg":
           case ".PNG":
           case ".JPG":
           case ".JPEG":
            break;
          default:
            alert('Please upload an image.');
            this.value = "";


         }
      })










    var options = {year: '2-digit', month: 'short', day: 'numeric' };



    var berryNiceNo = 0;
    var passionFruitNo = 0;
    var roseLycheeNo = 0;
    var floralBlendNo = 0;   
    var chrysanthemumNo = 0; 
    var berrySpookyNo = 0; 
    var shipping = 0;
    var separateAndPresetsArray = [];
    var presetTextArray = [];
    var totalNoPart2 = 0;
    var totalPrice = 0;
    var totalNo = 0;
    function calculatePricePart1(v, n){
      if(v ==""){
          v = 0;
      }

      if(v % 1 != 0 || v < 0){
        $('.totalPrice').html('');
        return false;
      }

     
      

      switch(n){
        case 1:
          berryNiceNo = parseInt(v);
          break;
        case 2:
          passionFruitNo = parseInt(v);
          break;
        case 3:
          roseLycheeNo = parseInt(v);
          break;
        case 4:
          floralBlendNo = parseInt(v);   
          break;
        case 5:
          chrysanthemumNo = parseInt(v);   
          break;
        case 6:
          berrySpookyNo = parseInt(v);   
          break;
      }
      totalNo = berryNiceNo + passionFruitNo + roseLycheeNo + floralBlendNo + chrysanthemumNo + berrySpookyNo;
      $("input[name='Total Bottles']").val(totalNo);
      if(totalNo < 6){
        $('.totalPrice').html("");
        return  false;
      }
      
      totalPrice = totalNo * 6.9 *  $("#mplan").val() * ($("#mplan").val() == 0.9 ? 8 : 12);
      $("input[name='Total Price']").val((Math.round(totalPrice * 10) /10).toFixed(2));
      if($("#separate").length){
        $("#separate").remove();
      }
      $('#orderSummary').prepend("<div id='separate'><b>Order Summary</b><br/><ul><li>Berry Nice x " + berryNiceNo + "</li><li>Passion Fruit x " + passionFruitNo + "</li><li>Rose Lychee x " + roseLycheeNo + "</li><li>" + "Floral Blend x " + floralBlendNo + "</li><li>" + "Chrysanthemum x " + chrysanthemumNo + "</li><li>" + "Berry Spooky x " + berrySpookyNo + "</li></ul></div>")
      $('.totalPrice').html("Total Price: $" + (Math.round(totalPrice * 10) /10).toFixed(2));

    }

    function calculatePricePart2(isDeliver){
      totalNoPart2 = 0;
      if(!isDeliver){
        shipping = 0;
      }else{
        shipping = 8;
      }
       var totalNo = berryNiceNo + passionFruitNo + roseLycheeNo + floralBlendNo + chrysanthemumNo + berrySpookyNo;
       separateAndPresetsArray[0] = totalNo;
        for(i = 0;i<separateAndPresetsArray.length;i++){
          if(separateAndPresetsArray[i] !== undefined){
            totalNoPart2 += separateAndPresetsArray[i];
          }
        
      }

      $("input[name='Total Bottles']").val(totalNoPart2);
      totalPrice = totalNoPart2 * 6.9 - Math.floor(totalNoPart2/4) * 2.6 + shipping - (totalNoPart2 >= 12 && shipping == 8 ? 8 : 0);
      $("input[name='Total Price']").val(totalPrice);
      // document.getElementById("totalPrice").innerHTML =  "Total Price: $" + totalPrice.toFixed(2);
      if($("#separate").length){
        $("#separate").remove();
      }
      $('#orderSummary').prepend("<div id='separate'><b>Order Summary</b><br/><ul><li>Berry Nice x " + berryNiceNo + "</li><li>Passion Fruit x " + passionFruitNo + "</li><li>Rose Lychee x " + roseLycheeNo + "</li><li>" + "Floral Blend x " + floralBlendNo + "</li><li>" + "Chrysanthemum x " + chrysanthemumNo + "</li><li>" + "Berry Spooky x " + berrySpookyNo + "</li></ul></div>")
       $('.totalPrice').html("Total Price: $" + totalPrice.toFixed(2));
    }


    var setCounter = 1;
    var setCounterV2 = 1;
    var setAlphabet = 'A';

   


    function minus(v, n){
      if(v.val()=="" || v.val() % 1 != 0 || v.val() <= 0){
        v.val(0);
        calculatePricePart1("0", n); // need to do this because 0 == "" is true
        return;
      }
      v.val(v.val()-1);

      calculatePricePart1(v.val(), n);
      


    }

    function plus(v, n){
      if(v.val()=="" || v.val() % 1 != 0 || v.val() < 0){
        v.val(1);
        calculatePricePart1(1, n);
        return;
      }
      v.val(parseInt(v.val())+1);
      calculatePricePart1(v.val(), n);


    }
    



    var regions = {
        regionOne: [01, 02, 03, 04, 05, 06, 07, 08, 14, 15, 16, 09, 10, 11, 12, 13, 17, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 81, 51, 52, 53, 54, 55, 82, 56, 57],
        regionTwo: [58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 77, 78, 75, 76, 79, 80]
      }

      var options2 = { weekday: 'short', year: 'numeric', month: 'long', day: 'numeric' };
      var today  = new Date();
      var slackTimeDaysDeliveryReg1 = {"Mon": 10, "Tue": 9, "Wed": 8, "Thu": 7, "Fri": 6, "Sat": 5, "Sun": 4};
     // var slackTimeDaysDeliveryReg2 = {"Mon": 10, "Tue": 9, "Wed": 8, "Thu": 7, "Fri": 6, "Sat": 5, "Sun": 4};
      var deliveryDates = [];
    function getAddress(e){
      console.log(e);
        if(e.value.length == 6 && !isNaN(e.value)){
          $.ajax({
            url:'https://geocode.xyz/' + e.value +'?region=SG',
            type:'GET',
            success: function(data){
                $("input[name='Address']").val($(data).find('#data > ol > li:nth-child(1) > a').text());
                
                if(regions.regionOne.includes(parseInt(e.value.substring(0,2))) || regions.regionTwo.includes(parseInt(e.value.substring(0,2)))){
                  
                    
                      $("#deliveryDate").text("Please take note of your first delivery date: " + new Date(Date.now() + 1000*60*60*24*slackTimeDaysDeliveryReg1[today.toLocaleDateString("en-US", options2).substring(0,3)]).toLocaleDateString("en-US", options) + ", (7pm to 10pm)");
                      deliveryDates.push(new Date(Date.now() + 1000*60*60*24*slackTimeDaysDeliveryReg1[today.toLocaleDateString("en-US", options2).substring(0,3)]).toLocaleDateString("en-US", options));
                      var g = $("#mplan").val() == 0.9 ? 8 : 12
                      for(i = 1; i < g; i++){
                        deliveryDates.push(new Date(Date.now() + 1000*60*60*24*(slackTimeDaysDeliveryReg1[today.toLocaleDateString("en-US", options2).substring(0,3)] + (i*7) )).toLocaleDateString("en-US", options))
                      }


                    
                }else{
                  $("#deliveryDate").text("");
                }
            },
            error: function (jqXHR, textStatus, errorThrown) { $("input[name='Address']").val(""); $("#deliveryDate").text("");}
          });



        }else{
          $("input[name='Address']").val(""); $("#deliveryDate").text("");
        }
      }

     
      

    $(document).ready(function() {

      


     var section1InputTextValueReqlength = $('.section1InputText').length;
     var giftInputReqlength = $('.giftInput').length;
     
      var section3InputTextValueReqlength = $('.section3InputText').length;
      var sect2Or3;
      var section1InputTextValue;
      var section1InputTextValueNoOfBottle;
      var section1InputTextValueNoOfBottleReqlength = 0;



      $("#sect1Next").click(function(){
        section1InputTextValueNoOfBottleReqlength = $('.noOfBottle').length; // need to put in this click event as the number of such elememts is dynamic due to presets
        section1InputTextValue = $('.section1InputText').filter(function () {
        return this.value != '';
        });

        // checking if invalid value is entered in the choosing water kefir text boxes
        section1InputTextValueNoOfBottle = $('.noOfBottle').filter(function () {
        return (this.value >= 0 && this.value % 1 == 0) || '';
        });

        /*
        check if shipment is selected,
        name, email and phone number have been filled,
        number of each drink and preset filled is either a whole number or not filled,
        at least 1 drink is bought
        */

        //  console.log($("input[name='Shipment']:checked").length == 0);
        //  console.log(section1InputTextValue.length != section1InputTextValueReqlength);
        //  console.log(section1InputTextValueNoOfBottle.length != section1InputTextValueNoOfBottleReqlength);
        //  console.log(document.getElementById("email").value.indexOf("@") == -1 );
        //  console.log(totalNoPart2 == 0);
        if (section1InputTextValue.length != section1InputTextValueReqlength || section1InputTextValueNoOfBottle.length != section1InputTextValueNoOfBottleReqlength  || totalNo < 6) {
            alert('Please fill out all required fields appropriately.');
            return;
        }



        $("#section1").hide();
        $("#section3").show();


        var options3 = {year: 'numeric', month: 'short', day: 'numeric' };
        today1 = new Date();
        today1.setDate(today1.getDate() + 1);
        setInterval(function() {$('#dynamicImageCutOff').css("max-height", 330/356 * $("#qrcode").height()); }, 1000);
        $('#qrcode').attr("src","https://sgqrcode.com/paynow?mobile=96171119&uen=&editable=0&amount=" + $('.totalPrice').html().substring($('.totalPrice').html().indexOf("$") + 1, $('.totalPrice').html().length) + "&expiry=" + encodeURIComponent(dateToYMD(today1)) + "&ref_id=&company=");
        $('#qrcodeText').html('Valid till ' + today1.toLocaleDateString("en-US", options3) + ", 23:59")
       // $('#dynamicImageCutOff').css("max-height", 330/356 * $("#qrcode").height());
       
          
        
      })

      function dateToYMD(date) {
          var d = date.getDate();
          var m = date.getMonth() + 1; //Month from 0 to 11
          var y = date.getFullYear();
          return '' + y + '/' + (m<=9 ? '0' + m : m) + '/' + (d <= 9 ? '0' + d : d) + " 23:59";
      }
      $(window).resize(function(){
        $('#dynamicImageCutOff').css("max-height", 330/356 * $("#qrcode").height());
      });

     
      $("#sect3Back").click(function(){
          $("#section1").show();
          $("#section3").hide();
          
          
      })

      $("#sect3Next").click(function(){
          var section3InputTextValue = $('.section3InputText').filter(function () {
          return this.value != '';
          });

          if (section3InputTextValue.length !== section3InputTextValueReqlength || $("#deliveryDate").text() == "") {
            alert('Please fill out all required fields appropriately.');
            return;
          } 

          $("#section3").hide();
          $("#section4").show();
        


      })

      $("#sect4Back").click(function(){
        $("#section3").show();
          $("#section4").hide();
          
      }) 

      
   
    
    
		
    

     
 });
    


    </script>













          <!-- <script>
            const scriptURL = 'https://script.google.com/macros/s/AKfycbxL5k8P9-vVTUaTTZqmQgxu85oaJTRhJBy5uec0t2_aao6xassFzhSGXCkRxuP3JUlB0Q/exec'
            const form = document.forms['google-sheet']
          var a;
            form.addEventListener('submit', e => {
              e.preventDefault()
            
              fetch(scriptURL, { method: 'POST', body: new FormData(form)}) // new FormData contains a literal object with name/value pairs from the form
                .then(response => alert("great"))
                .catch(error => console.error('Error!', error.message))
            })
          </script> -->




          <script>
              const form = document.forms['google-sheet'];
              form.addEventListener("submit", (e) => {
                e.preventDefault();
               

                if($("#section4").is(":hidden")){
                  return;
                }
                $('#submitBtn').prop('disabled', true);
                if(form['(PayLah!/PayNow) Transaction Ref. No./Google Transaction ID'].value == ''){
                  alert('𝐏𝐥𝐞𝐚𝐬𝐞 𝐮𝐩𝐥𝐨𝐚𝐝 𝐚 𝐬𝐜𝐫𝐞𝐞𝐧 𝐬𝐡𝐨𝐭 𝐨𝐟 𝐭𝐡𝐞 "𝐓𝐫𝐚𝐧𝐬𝐚𝐜𝐭𝐢𝐨𝐧 𝐑𝐞𝐟. 𝐍𝐨./𝐆𝐨𝐨𝐠𝐥𝐞 𝐓𝐫𝐚𝐧𝐬𝐚𝐜𝐭𝐢𝐨𝐧 𝐈𝐃"')
                  $('#submitBtn').prop('disabled', false);
                  return;
                }
               
               
                
                $('#processing').text("Processing, please wait...");
                var file1 = {
                  name:'empty',
                  type:'empty'
                }
                

                const file = form['(PayLah!/PayNow) Transaction Ref. No./Google Transaction ID'].files[0];
                const fr = new FileReader();
                fr.readAsArrayBuffer(file);
                fr.onload = (f) => {
                  const url = "https://script.google.com/macros/s/AKfycby5a6-kRJF0RCtI87j03eZNqKdBK3OAf9dBVb0GW6PHEQrjk6tSTqpe1n4z8RhM3Ya1/exec"; 
                  const qs = new URLSearchParams({
                    filename: file.name,
                    mimeType: file.type,
                    filename1: file1.name,
                    mimeType1: file1.type,
                  });
                  fetch(`${url}?${qs}`, {
                    method: "POST",
                    body: JSON.stringify({'(PayLah!/PayNow) Transaction Ref. No./Google Transaction ID': [...new Int8Array(f.target.result)],
                                        'Subscription Plan': ($("#mplan").val() == 0.9 ? '2 months - 10% off' : '3 months - 20% off'),
                                        'Name': $("input[name='Name']").val(), 
                                        'Phone Number (sg)': $("input[name='Phone Number (sg)']").val(), 
                                        'Email Address': $("input[name='Email Address']").val(), 
                                        'No. of Berry Nice': $("input[name='No. of Berry Nice']").val(),
                                        'No. of Passion Fruit': $("input[name='No. of Passion Fruit']").val(), 
                                        'No. of Rose Lychee': $("input[name='No. of Rose Lychee']").val(), 
                                        'No. of Floral Blend': $("input[name='No. of Floral Blend']").val(),
                                        'No. of Chrysanthemum': $("input[name='No. of Chrysanthemum']").val(),
                                        'No. of Berry Spooky': $("input[name='No. of Berry Spooky']").val(),
                                        'Total Bottles Per Week': $("input[name='Total Bottles']").val() / ($("#mplan").val() == 0.9 ? 8 : 12),
                                        'Total Bottles': $("input[name='Total Bottles']").val(), 
                                        'Total Price': $("input[name='Total Price']").val(), 
                                        'Postal Code': $("input[name='Postal Code']").val(), 
                                        'Address': $("input[name='Address']").val(), 
                                        'Unit Number': $("input[name='Unit Number']").val(),
                                        'Delivery Dates': JSON.stringify(deliveryDates),
                                        'Verification': 'Pending',
                                        'VEmail': 'Pending',
                                        'VDateline': slackTimeDaysDeliveryReg1[today.toLocaleDateString("en-US", options2).substring(0,3)] - 1,
                                        'Week No.': '#1/' + ($("#mplan").val() == 0.9 ? 8 : 12),
                                        'Subscription Status': 'Active'})
                  })
                    .then((res) => {alert('Thank you for your order, We have sent you an email.');
                    location.reload();})
                    .then(console.log)
                    .catch(console.log);
                };
              });
          </script>

        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</body>
</html>
